<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Treemap</title>
	<!-- Place favicon.ico and apple-touch-icon.png in the root of your domain and delete these references
	<link rel="shortcut icon" href="/favicon.ico">
  -->
  <link rel="icon"
    type="image/png"
    href="/static/img/favicon.32.png" />
  <link rel="shortcut icon" href="/static/img/favicon.ico">

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link rel="stylesheet" media="all" href=""/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<!-- Adding "maximum-scale=1" fixes the Mobile Safari auto-zoom bug: http://filamentgroup.com/examples/iosScaleBug/ -->

  <!-- TODO: separate out tributary ui styling from header styling? some of it overlaps -->
  <link rel="stylesheet" href="/static/css/trib.css">
  <link rel="stylesheet" href="/static/css/animation.css">
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/static/css/tipsy.css">
  <link rel='stylesheet' type='text/css' href='http://yui.yahooapis.com/2.9.0/build/reset/reset-min.css' />

  <!-- And the main styles -->
  <link rel="stylesheet" href="/static/css/header.css" type="text/css" media="screen" title="Primary Stylesheet" charset="utf-8">

  <!-- Add jQuery -->
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>

</head>
<body>
<div id="container">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:xlink="http://www.w3.org/1999/xlink" class="tributary_svg" width="100%" height="2000"></svg>
</div>

<script>
var pathJson = {
            "name": "Sample data",
            "children": [{
                "name": "Title 1",
                "size": 1,
                "children": [{
                    "name": "Title 1-1",
                    "size": 1,
                    "children": [{
                        "name": "1-1-1",
                        "size": 200
                    }, {
                        "name": "1-1-2",
                        "size": 100
                    }, {
                        "name": "1-1-3",
                        "size": 512
                    }, {
                        "name": "1-1-4",
                        "size": 653
                    }]
                }, {
                    "name": "Title 1-2",
                    "size": 1,
                    "children": [{
                        "name": "1-2-1",
                        "size": 300
                    }, {
                        "name": "1-2-2",
                        "size": 863
                    }, {
                        "name": "1-2-3",
                        "size": 321
                    }]
                }, {
                    "name": "Title 1-3",
                    "size": 1,
                    "children": [{
                        "name": "1-3-1",
                        "size": 600
                    }]
                }]
            }]
        }

        var w = 1280 - 80,
            h = 800 - 180,
            x = d3.scale.linear().range([0, w]),
            y = d3.scale.linear().range([0, h]),
			pad = 30,
            color = d3.scale.category10(),
            root,
            node;

        var treemap = d3.layout.treemap()
						.round(false)
						.size([w, h])
						.sticky(false)
						.padding([pad, 0, 0, 0])
						.value(function (d) {return d.size;});

        var svg = d3.select("svg")
            		.append("svg:svg")
					.attr("width", w)
					.attr("height", h)
					.append("svg:g")
					.attr("transform", "translate(.5,.5)");

        node = root = pathJson;

        var nodes = treemap.nodes(root);
        var children = nodes.filter(function (d) {return !d.children;});
        var parents = nodes.filter(function (d) {return d.children;});

        var childCell = svg.selectAll("g")
						   .data(children)
						   .enter().append("svg:g")
						   .attr("class", "childCell")
						   .attr("transform", function (d) {
									return "translate(" + d.x + "," + d.y + ")";})
						   .on("click", function (d) {
									return zoom(node == d.parent ? root : d.parent);});

        childCell.append("svg:rect")
			     .attr("width", function (d) {return d.dx - 1;})
				 .attr("height", function (d) {return d.dy - 1;})
				 .attr("rx", 7)
				 .attr("ry", 7)
				 .style("fill", function (d) {return color(d.parent.name);});

        childCell.append("svg:text")
				 .attr("x", function (d) {return d.dx / 2;})
				 .attr("y", function (d) {return d.dy / 2;})
				 .attr("dy", ".35em")
				 .attr("text-anchor", "middle")
				 .text(function (d) {return d.name;})
				 .style("opacity", function (d) {
						d.w = this.getComputedTextLength();
						return d.dx > d.w ? 1 : 0;
					});	

        var parentCell = svg.selectAll("g.parentCell")
							.data(parents)
							.enter().append("svg:g")
							.attr("class", "parentCell")
							.attr("transform", function (d) {
								return "translate(" + d.x + "," + d.y + ")";});

        parentCell = parentCell.filter(function (d) {return d.depth > 0;});
         
		parentCell.append("svg:rect")
				  .attr("width", function (d) {return d.dx - 1;})
				  .attr("height", pad)
				  .style("fill", "orange")
				  .style("fill-opacity", 0.5);
				  
        parentCell.append("text")
				  .text(function (d) {return d.name;})
          		  //sort of a patch
				  .attr("x", function(d) { return (d.dx-d.name.length) / 2.2; })
				  .attr("y", textHeight(root))
				  .style("font-size",20)
				  .style("font-weight", "bold");
		
		//and another one
		function textHeight(d) {
			var ky = h / d.dy;
            y.domain([d.y, d.y + d.dy]);
			return (ky * d.dy)/pad;
		}

$(window).scroll(function() {
   if($(window).scrollTop() + $(window).height() == $(document).height()) {
  alert('moi');
//       var new_div = '<div class="new_block"></div>';
//       $('.main_content').append(new_div.load('/path/to/script.php'));
   }
});


</script>

</body>
</html>

