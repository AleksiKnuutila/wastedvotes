<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<title>Treemap</title>
	<!-- Place favicon.ico and apple-touch-icon.png in the root of your domain and delete these references
	<link rel="shortcut icon" href="/favicon.ico">
  -->
  <link rel="icon"
    type="image/png"
    href="/static/img/favicon.32.png" />
  <link rel="shortcut icon" href="/static/img/favicon.ico">

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link rel="stylesheet" media="all" href=""/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<!-- Adding "maximum-scale=1" fixes the Mobile Safari auto-zoom bug: http://filamentgroup.com/examples/iosScaleBug/ -->

  <!-- TODO: separate out tributary ui styling from header styling? some of it overlaps 
  <link rel="stylesheet" href="/static/css/trib.css">
  <link rel="stylesheet" href="/static/css/animation.css">
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/static/css/tipsy.css">
  <link rel='stylesheet' type='text/css' href='http://yui.yahooapis.com/2.9.0/build/reset/reset-min.css' />
-->

  <!-- And the main styles -->
  <link rel="stylesheet" href="/static/css/header.css" type="text/css" media="screen" title="Primary Stylesheet" charset="utf-8">

  <!-- Add jQuery -->
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <!-- d3 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
  <script src="bower_components/d3-tip/index.js"></script> 
  <!-- <script src="js/bootstrap-popover.js"></script>-->
  
  <!-- Bootstrap
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
 -->

</head>
<body>
<div class="container">

	    <a id="popoverData" class="btn" href="#" data-content="Popover with data-trigger" rel="popover" data-placement="bottom" data-original-title="Title" data-trigger="hover">Popover with data-trigger</a>

	        <a id="popoverOption" class="btn" href="#" data-content="Popup with option trigger" rel="popover" data-placement="bottom" data-original-title="Title">Popup with option trigger</a>
		    
		    
</div>

<div id="container">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:xlink="http://www.w3.org/1999/xlink" class="tributary_svg" width="100%" height="2000"></svg>
</div>

<!--
var pathJson = {
            "name": "Sample data",
            "children": [{
                "name": "Title 1",
                "size": 1,
                "children": [{
                    "name": "Title 1-1",
                    "size": 1,
                    "children": [{
                        "name": "1-1-1",
                        "size": 200
                    }, {
                        "name": "1-1-2",
                        "size": 100
                    }, {
                        "name": "1-1-3",
                        "size": 512
                    }, {
                        "name": "1-1-4",
                        "size": 653
                    }]
                }, {
                    "name": "Title 1-2",
                    "size": 1,
                    "children": [{
                        "name": "1-2-1",
                        "size": 300
                    }, {
                        "name": "1-2-2",
                        "size": 863
                    }, {
                        "name": "1-2-3",
                        "size": 321
                    }]
                }, {
                    "name": "Title 1-3",
                    "size": 1,
                    "children": [{
                        "name": "1-3-1",
                        "size": 600
                    }]
                }]
            }]
        }
-->
<script>

var pathJson = {
    "children": [
        {
            "children": [
                {
                    "name": "BNP",
                    "size": "697",
                    "win": 0
                },
                {
                    "name": "Con",
                    "size": "10902",
                    "win": 0
                },
                {
                    "name": "Green",
                    "size": "7095",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "13960",
                    "win": 1
                },
                {
                    "name": "Lab",
                    "size": "13650",
                    "win": 0
                },
                {
                    "name": "Others",
                    "size": "102",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "1145",
                    "win": 0
                }
            ],
            "name": "Norwich South",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "Con",
                    "size": "12275",
                    "win": 0
                },
                {
                    "name": "Green",
                    "size": "16238",
                    "win": 1
                },
                {
                    "name": "LD",
                    "size": "7159",
                    "win": 0
                },
                {
                    "name": "Lab",
                    "size": "14986",
                    "win": 0
                },
                {
                    "name": "Others",
                    "size": "228",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "948",
                    "win": 0
                }
            ],
            "name": "Brighton Pavilion",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "Con",
                    "size": "10861",
                    "win": 0
                },
                {
                    "name": "Green",
                    "size": "789",
                    "win": 0
                },
                {
                    "name": "Ind",
                    "size": "272",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "14292",
                    "win": 1
                },
                {
                    "name": "Lab",
                    "size": "10274",
                    "win": 0
                },
                {
                    "name": "Others",
                    "size": "156",
                    "win": 0
                },
                {
                    "name": "SNP",
                    "size": "8563",
                    "win": 0
                }
            ],
            "name": "Argyll & Bute",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "BNP",
                    "size": "2546",
                    "win": 0
                },
                {
                    "name": "Con",
                    "size": "11773",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "14083",
                    "win": 0
                },
                {
                    "name": "Lab",
                    "size": "14186",
                    "win": 1
                },
                {
                    "name": "Others",
                    "size": "212",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "1720",
                    "win": 0
                }
            ],
            "name": "Oldham East & Saddleworth",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "BNP",
                    "size": "1517",
                    "win": 0
                },
                {
                    "name": "Con",
                    "size": "10063",
                    "win": 0
                },
                {
                    "name": "Ind",
                    "size": "835",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "7388",
                    "win": 0
                },
                {
                    "name": "Lab",
                    "size": "10777",
                    "win": 1
                },
                {
                    "name": "Others",
                    "size": "331",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "2043",
                    "win": 0
                }
            ],
            "name": "Grimsby, Great",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "BNP",
                    "size": "328",
                    "win": 0
                },
                {
                    "name": "Con",
                    "size": "17290",
                    "win": 0
                },
                {
                    "name": "Green",
                    "size": "759",
                    "win": 0
                },
                {
                    "name": "Ind",
                    "size": "91",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "16491",
                    "win": 0
                },
                {
                    "name": "Lab",
                    "size": "17332",
                    "win": 1
                },
                {
                    "name": "Others",
                    "size": "123",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "408",
                    "win": 0
                }
            ],
            "name": "Hampstead & Kilburn",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "Con",
                    "size": "7320",
                    "win": 0
                },
                {
                    "name": "Ind",
                    "size": "190",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "11988",
                    "win": 0
                },
                {
                    "name": "Lab",
                    "size": "16039",
                    "win": 1
                },
                {
                    "name": "Others",
                    "size": "12240",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "950",
                    "win": 0
                }
            ],
            "name": "Birmingham Hall Green",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "BNP",
                    "size": "2000",
                    "win": 0
                },
                {
                    "name": "Con",
                    "size": "14283",
                    "win": 0
                },
                {
                    "name": "Ind",
                    "size": "264",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "12638",
                    "win": 0
                },
                {
                    "name": "Lab",
                    "size": "14896",
                    "win": 1
                },
                {
                    "name": "Others",
                    "size": "170",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "829",
                    "win": 0
                }
            ],
            "name": "Derby North",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "Con",
                    "size": "7744",
                    "win": 0
                },
                {
                    "name": "Ind",
                    "size": "2225",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "2592",
                    "win": 0
                },
                {
                    "name": "Lab",
                    "size": "11490",
                    "win": 1
                },
                {
                    "name": "Others",
                    "size": "163",
                    "win": 0
                },
                {
                    "name": "PC",
                    "size": "9029",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "1201",
                    "win": 0
                }
            ],
            "name": "Ynys Mon",
            "size": 1
        },
        {
            "children": [
                {
                    "name": "BNP",
                    "size": "2781",
                    "win": 0
                },
                {
                    "name": "Con",
                    "size": "10698",
                    "win": 0
                },
                {
                    "name": "Ind",
                    "size": "396",
                    "win": 0
                },
                {
                    "name": "LD",
                    "size": "16047",
                    "win": 0
                },
                {
                    "name": "Lab",
                    "size": "16239",
                    "win": 1
                },
                {
                    "name": "Others",
                    "size": "1102",
                    "win": 0
                },
                {
                    "name": "UKIP",
                    "size": "933",
                    "win": 0
                }
            ],
            "name": "Ashfield",
            "size": 1
        }
    ],
    "name": "election data"
}

        var w = 1280 - 80,
            h = 800 - 180,
            x = d3.scale.linear().range([0, w]),
            y = d3.scale.linear().range([0, h]),
			pad = 30,
            color = d3.scale.category10(),
            root,
            node;

        var treemap = d3.layout.treemap()
						.round(false)
						.size([w, h])
						.sticky(false)
						.padding([pad, 0, 0, 0])
						.value(function (d) {return d.size;});

        var tip = d3.tip()
          .attr('class', 'd3-tip')
          .offset([-10, 0])
          .html(function(d) {
            return "<strong>Frequency:</strong> <span style='color:red'>" + d.frequency + "</span>";
          })


        var svg = d3.select("svg")
            		.append("svg:svg")
					.attr("width", w)
					.attr("height", h)
					.append("svg:g")
					.attr("transform", "translate(.5,.5)");

        svg.call(tip);

        node = root = pathJson;

        var nodes = treemap.nodes(root);
        var children = nodes.filter(function (d) {return !d.children;});
        var parents = nodes.filter(function (d) {return d.children;});

        var childCell = svg.selectAll("g")
						   .data(children)
						   .enter().append("svg:g")
						   .attr("class", "childCell")
						   .attr("transform", function (d) {
									return "translate(" + d.x + "," + d.y + ")";})
						   .on("click", function (d) {
									return zoom(node == d.parent ? root : d.parent);});

        childCell.append("svg:rect")
			     .attr("width", function (d) {return d.dx - 1;})
				 .attr("height", function (d) {return d.dy - 1;})
				 .attr("rx", 7)
				 .attr("ry", 7)
				 .style("fill", function (d) {if (d.win == 0) { return "rgb(125,125,125)" } else { return color(d.parent.name);}})
                                 .on('mouseover', tip.show)
                                 .on('mouseout', tip.hide);


        childCell.append("svg:text")
				 .attr("x", function (d) {return d.dx / 2;})
				 .attr("y", function (d) {return d.dy / 2;})
				 .attr("dy", ".35em")
				 .attr("text-anchor", "middle")
				 .text(function (d) {return d.name;})
				 .style("opacity", function (d) {
						d.w = this.getComputedTextLength();
						return d.dx > d.w ? 1 : 0;
					})
                                 .on('mouseover', tip.show)
                                 .on('mouseout', tip.hide);

        var parentCell = svg.selectAll("g.parentCell")
							.data(parents)
							.enter().append("svg:g")
							.attr("class", "parentCell")
							.attr("transform", function (d) {
								return "translate(" + d.x + "," + d.y + ")";});

        parentCell = parentCell.filter(function (d) {return d.depth > 0;});
         
		parentCell.append("svg:rect")
				  .attr("width", function (d) {return d.dx - 1;})
				  .attr("height", pad)
				  .style("fill", "orange")
				  .style("fill-opacity", 0.5);
				  
        parentCell.append("text")
				  .text(function (d) {return d.name;})
          		  //sort of a patch
				  .attr("x", function(d) { return (d.dx-d.name.length) / 2.2; })
				  .attr("y", textHeight(root))
				  .style("font-size",20)
				  .style("font-weight", "bold");
		
		//and another one
		function textHeight(d) {
			var ky = h / d.dy;
            y.domain([d.y, d.y + d.dy]);
			return (ky * d.dy)/pad;
		}

$(window).scroll(function() {
   if($(window).scrollTop() + $(window).height() == $(document).height()) {
  alert('moi');
//       var new_div = '<div class="new_block"></div>';
//       $('.main_content').append(new_div.load('/path/to/script.php'));
   }
});

$('#popoverData').popover();
$('#popoverOption').popover({ trigger: "hover" });


</script>

</body>
</html>

