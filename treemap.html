<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>WASTED VOTES - UK General Election 2015</title>

  <meta name="description" content="YourCandidates.org.uk is the first UK website that helps you discover and compare the candidates for parliament from your area. Fill in your postcode and connect with local candidates. See what theyâ€™re up to on social media, get the latest predictions on local results, and compare policies.">
  <meta name="keywords" content="election uk politics voting advice candidates parliament ge2015" />   
    
  <meta name="author" content="">
  <meta name="copyright" content="">
  <meta name="application-name" content=""> 

  <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62778471-1', 'auto');
  ga('send', 'pageview');

</script>
  
  <!-- for Facebook -->          
  <meta property="og:title" content="Wasted votes: This visualisation shows how undemocratic the UK elections were" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="http://www.wastedvotes.org/wastedvotes-ogimage.png" />
  <meta property="og:url" content="http://www.wastedvotes.org" />
  <meta property="og:description" content="Want to understand why the results from the UK election were so distorted? This visualisation shows how shockingly bad the system is." />
  
  <!-- for Twitter -->          
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Wasted votes: This visualisation shows how undemocratic the UK elections were" />
  <meta name="twitter:description" content="Want to understand why the results from the UK election were so distorted? This visualisation shows how shockingly bad the system is." />
  <meta name="twitter:image" content="" />

  <!-- Google fonts -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800' rel='stylesheet' type='text/css'>
  <!--  <link href='http://fonts.googleapis.com/css?family=Playfair+Display' rel='stylesheet' type='text/css'> -->

  <!-- Add jQuery -->
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <!-- d3 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
  <script src="bower_components/d3-tip/index.js"></script> 
  <!-- <script src="js/bootstrap-popover.js"></script>-->
  <script src="data-converted.json"></script> 

  <script src="js/color.js"></script>
  
<style>
.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
  max-width: 160px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip.n:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}

h1.topheader {
  font-family: 'Open Sans', sans-serif;
  font-weight: 700;
  font-size: 45px;
  margin-bottom: 0px;
  margin-top: 0px;
}
h1.topsubheader {
  font-family: 'Open Sans', sans-serif;
  font-weight: 400;
  font-size: 25px;
  margin-top: 0px;
  margin-bottom: 0px;
}
@media screen and (min-width: 767px) {
div.topheaderright {
  float:right;
}
}
div.topheaderright {
  max-width: 430px;
}
@media screen and (min-width: 767px) {
div.topheaderleft {
  float:left;
}
}
div.topheaderleft {
  width: auto;
}
p.topheadertext {
  font-family: 'Open Sans', sans-serif;
  font-size: 13px;
}


h1.areaname {
  font-size: 28px;
  font-weight: 400;
  font-family: 'Open Sans', sans-serif;
  word-wrap: break-word;
    -ms-word-break:break-all;
    word-break:break-all;
    word-break:break-word;
    -webkit-hyphens:auto;
    -moz-hyphens:auto;
    hyphens:auto;
}

h1.percentages {
  font-size: 18px;
  font-weight: 600;
  font-family: 'Open Sans', sans-serif;
  word-wrap: break-word;
    -ms-word-break:break-all;
    word-break:break-all;
    word-break:break-word;
    -webkit-hyphens:auto;
    -moz-hyphens:auto;
    hyphens:auto;
}

div.fullcontainer {
  max-width: 768px;
  width: 100%;
  align: center;
  margin-left: auto;
  margin-right: auto;
}

</style>

</head>
<body>
<div class="fullcontainer">
  <div class="row topheaderleft">
    <h1 class="topheader">Wasted votes</h1>
    <h1 class="topsubheader">UK General Election 2015</h1>
  </div>
  <div class="topheaderright">
	  <p class="topheadertext">In every constituency, the candidate with most votes wins. The rest of the votes count for nothing. That is why the results are <a href="http://www.electoral-reform.org.uk/making-votes-count">so undemocratic</a>. <a href="http://action.makeseatsmatchvotes.org/ea-action/action?ea.client.id=1754&ea.campaign.id=38262&ea.tracking.id=msmv">Join the fight</a> towards a new democratic system.</p>
  <p class="topheadertext">Every box below represents votes received by a party. Stronger colours indicate the winner, and lighter ones votes that were ignored. Move your mouse or click on boxes for more information. Author: <a href="http://www.twitter.com/knuutila">@knuutila</a></p>
  </div>
  <div style="clear: both;"></div>
<hr style="height:3px;border:none;color:#333;background-color:#333;">

<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:xlink="http://www.w3.org/1999/xlink" class="tributary_svg0" preserveAspectRatio="xMinYMin meet" viewBox="0 0 768 1600" width="100%" height="100%"></svg>
</div>
<script>

// "CON", "LAB", "UKIP", "LD", "SNP", "GRN", "DUP", "PC", "SF", "UUP", "IND", "SDLP", "APNI", "TUSC", "SPE", "NHA", "TUV", "RES", "CSA", "Others"

var BOXESPERSVG = 12;

var Color = net.brehaut.Color;
COLOURS = {
"purple": "rgb(167,34,128)",
"blue": "rgb(62,90,168)",
"red": "rgb(171,25,23)",
"yellow": "rgb(255,217,8)",
"green": "rgb(68,182,95)"
}

GRAY_COLOUR = Color("rgb(220,220,214)");
WHITE_COLOUR = Color("rgb(240,240,240)");
PARTY_COLOURS = { //"Con": "rgb(181,226,234)",
                  "CON": [ COLOURS["blue"], Color(COLOURS["blue"]).blend(WHITE_COLOUR, 0.72) ],
                  "DUP": [ COLOURS["blue"], Color(COLOURS["blue"]).blend(WHITE_COLOUR, 0.72) ],
                  "GRN": [ COLOURS["green"], Color(COLOURS["green"]).blend(WHITE_COLOUR, 0.85) ],
                  "LD": [ COLOURS["yellow"], Color(COLOURS["yellow"]).blend(WHITE_COLOUR, 0.85) ],
                  "LAB": [ COLOURS["red"], Color(COLOURS["red"]).blend(WHITE_COLOUR, 0.75) ],
                  "SNP": [ COLOURS["yellow"], Color(COLOURS["yellow"]).blend(WHITE_COLOUR, 0.85) ],
                  "PC": [ COLOURS["yellow"], Color(COLOURS["yellow"]).blend(WHITE_COLOUR, 0.85) ],
                  "UKIP": [ COLOURS["purple"], Color(COLOURS["purple"]).blend(WHITE_COLOUR, 0.85) ]
}

// "CON", "LAB", "UKIP", "LD", "SNP", "GRN", "DUP", "PC", "SF", "UUP", "IND", "SDLP", "APNI", "TUSC", "SPE", "NHA", "TUV", "RES", "CSA", "Others"
function getParty(party) {
  var PARTY_NAMES = { "CON": "Conservatives",
                    "DUP": "DUP",
                    "GRN": "Greens",
                    "LD": "Liberal Democrats",
                    "LAB": "Labour",
                    "SNP": "SNP",
                    "PC": "Plaid Cymru",
                    "Others": "others",
                    "IND": "independents",
                    "UKIP": "UKIP"
  }
  if(PARTY_NAMES[party])
    { return PARTY_NAMES[party] }
  else 
    { return party }
}

window.dataIndex = 0;

function getNextData() {
  data = []
  targetIndex = window.dataIndex + 1
	  for (i = window.dataIndex * BOXESPERSVG; i < targetIndex * BOXESPERSVG; i++) { 
	    data.push(pathJson['children'][i]);
	  }
	  hash = {};
	  hash['children'] = data;
	  return hash;
	}

	function DrawTreeMap() {

		var w = window.innerWidth,
		    h = 1600,
		    x = d3.scale.linear().range([0, w]),
		    y = d3.scale.linear().range([0, h]),
				pad = 0,
		    color = d3.scale.category10(),
		    root,
		    node;


		var svgwidth = $('.fullcontainer').width();
		var treemap = d3.layout.treemap()
	    .sort(function(a,b) { return a.size - b.size; })
							.round(false)
							.size([768, h])
							.sticky(false)
							.mode("squarify")
							.ratio(1)
							.padding([pad, 10, 10, 10])
							.value(function (d) {return d.size;});
	//						.sort(d3.ascending)

		var tip = d3.tip()
		  .attr('class', 'd3-tip')
		  .offset([-10, 0])
		  .html(function(d) {
	if (d.win == 1) { 
		return "<span style='color:red'>"+d.size+" votes</span> won "+ getParty(d.name) + " an MP"
	//return GRAY_COLOUR.toCSS()
	} else {
	return "<span style='color:red'>"+d.size+" votes</span> for "+getParty(d.name) + " made no difference"
	return getParty(d.name) + " lost :("
	//            return "<strong>Frequency:</strong> <span style='color:red'>" + d.frequency + "</span>";
	}
	})

		tip.direction(function(d) {
		  if(d.x < 40) return 'e'
		  if((window.innerWidth - d.x - d.dx) < 30) return 'n';
		  return 'n';
		})

		var svg = d3.select(".tributary_svg"+window.dataIndex.toString())
				.append("svg:svg")
					.attr('id', 'my-svg-div')
						.attr("width", "768px")
					.attr("height", h)
					.append("svg:g")
					.attr("transform", "translate(.5,.5)");

        svg.call(tip);

//        node = root = pathJson;
        node = root = getNextData();

        var nodes = treemap.nodes(root);
        var children = nodes.filter(function (d) {return !d.children;});
        var parents = nodes.filter(function (d) {return d.children;});

        var childCell = svg.selectAll("g")
						   .data(children)
						   .enter().append("svg:g")
						   .attr("class", "childCell")
						   .attr("transform", function (d) {
									return "translate(" + d.x + "," + d.y + ")";})
                                 .on('mouseover', tip.show)
                                 .on('mouseout', tip.hide);

//        childCell.append("svg:text")
//				 .attr("x", function (d) {return d.dx / 2;})
//				 .attr("y", function (d) {return d.dy / 2;})
//				 .attr("dy", ".35em")
//				 .attr("text-anchor", "middle")
//				 .text(function (d) {return d.name;})
//				 .style("opacity", function (d) {
//						d.w = this.getComputedTextLength();
//						return d.dx > d.w ? 1 : 0;
//					});

        var parentCell = svg.selectAll("g.parentCell")
							.data(parents)
							.enter().append("svg:g")
							.attr("class", "parentCell")
                                                        .attr("childsize", function (d) {
                                                                return d.dx + "," + d.dy + ")";})
							.attr("transform", function (d) {
								return "translate(" + d.x + "," + d.y + ")";});

        parentCell = parentCell.filter(function (d) {return d.depth > 0;});

//        parentCell.append("text")
//				  .text(function (d) {return d.name;})
//          		  //sort of a patch
//				  .attr("x", 20)
//				  .attr("y", 52)
////				  .attr("x", function(d) { return (d.dx-d.name.length) / 2.2; })
////				  .attr("y", textHeight(root))
//				  .style("font-size",50)
//				  .style("font-weight", "bold");

parentCell.append("foreignObject")
    .attr("width", function (d) {return d.dx - 70;})
    .attr("height", 400)
    .attr("x", 12)
    .attr("y", 5)
    .attr("pointer-events", "none")
  .append("xhtml:body")
//    .style("font", "14px 'Helvetica Neue'")
//    .html("<h1>An HTML Foreign Object in SVG</h1>");
//    .text('wfoeijweoijfew')
    .html(function (d) {return "<h1 class=\"areaname\">"+d.name+"</h1>";});

parentCell.append("foreignObject")
    .attr("width", 300)
    .attr("height", 400)
//    .attr("x", 20)
//    .attr("y", 400)
    .attr("x", function (d) {return d.dx - 205;})
    .attr("y", function (d) {return d.dy - 45;})
    .attr("pointer-events", "none")
  .append("xhtml:body")
//  .append("xhtml:body")
//    .style("font", "14px 'Helvetica Neue'")
//    .html("<h1>An HTML Foreign Object in SVG</h1>");
    .html(function (d) {return "<h1 class=\"percentages\">"+d.shareign+" of votes ignored"+"</h1>";});
		
        childCell.append("svg:rect")
			     .attr("width", function (d) {return d.dx - 1;})
				 .attr("height", function (d) {return d.dy - 1;})
				 .attr("rx", 7)
				 .attr("ry", 7)
				 .style("fill", function (d) {if (d.win == 0) { 
//return GRAY_COLOUR.toCSS()
//if(PARTY_COLOURS[d.name]) { return Color(PARTY_COLOURS[d.name]).blend(GRAY_COLOUR, 0.85).toCSS() } else { return GRAY_COLOUR.toCSS() }
if(PARTY_COLOURS[d.name]) { return Color(PARTY_COLOURS[d.name][1]).toCSS() } else { return GRAY_COLOUR.toCSS() }
} else { if(PARTY_COLOURS[d.name]) { return PARTY_COLOURS[d.name][0] } else { return GRAY_COLOUR.toCSS() }}})

		//and another one
		function textHeight(d) {
			var ky = h / d.dy;
            y.domain([d.y, d.y + d.dy]);
			return (ky * d.dy)/pad;
		}

}
DrawTreeMap();

//window.origsize = window.innerWidth;
//$(window).resize(function () {
//	if(abs(window.innerWidth - window.origsize) > 30) {
//    window.origsize = window.innerWidth;
//    window.dataIndex = 0;
//    $('svg').remove();
//    $('.d3-tip').remove()
//     $('.fullcontainer').append('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:xlink="http://www.w3.org/1999/xlink" class="tributary_svg'+window.dataIndex.toString()+'" preserveAspectRatio="xMinYMin meet" viewBox="0 0 768 1600" width="100%" height="100%"></svg>');
//    window.scrollTo(0, 0);
//    DrawTreeMap();
//    }
//});

$(window).scroll(function() {
   if($(window).scrollTop() + $(window).height() > $(document).height() - 50 && window.dataIndex < ((655 / BOXESPERSVG) - 4)) {
     window.dataIndex = window.dataIndex + 1;
     $('.fullcontainer').append('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:xlink="http://www.w3.org/1999/xlink" class="tributary_svg'+window.dataIndex.toString()+'" preserveAspectRatio="xMinYMin meet" viewBox="0 0 768 1600" width="100%" height="100%"></svg>');
     DrawTreeMap();
   }
});

</script>

</body>
</html>

